<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <title>AI 搜尋練習</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px;
            line-height: 1.5;
        }

        h2 {
            margin-bottom: 8px;
        }

        #query {
            width: 100%;
            max-width: 600px;
            padding: 8px;
        }

        #answer {
            white-space: pre-wrap;
            margin-top: 16px;
            border: 1px solid #ccc;
            padding: 12px;
            max-width: 600px;
        }

        button {
            padding: 8px 16px;
            margin-top: 8px;
            margin-right: 8px;
        }
    </style>
</head>

<body>

    <h2>AI 搜尋練習</h2>

    <p>輸入你想查詢的內容與來源</p>

    <input id="query" placeholder="輸入搜尋句..." />
    <div>
        <button onclick="search()">開始搜尋</button>
        <!-- <button onclick="fillFromUrl()">帶入 PlayReal 搜尋句</button> -->
    </div>

    <div id="answer"></div>

    <button onclick="goBack()">回到遊戲</button>

    <script>
        // 讀取 URL querystring 中的 ?q= 參數
        function getQueryParam(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name) || "";
        }

        // 從 URL 把 PlayReal 傳來的搜尋句塞進輸入框
        function fillFromUrl() {
            const q = getQueryParam("q");
            if (q) {
                // 使用 decodeURIComponent 確保中文能正確顯示
                const decodedQ = decodeURIComponent(q);
                document.getElementById("query").value = decodedQ;
            }
        }

        async function search() {
            const q = document.getElementById("query").value.trim();
            if (!q) {
                alert("請先輸入搜尋句");
                return;
            }

            document.getElementById("answer").innerText = "搜尋中，請稍候……";

            try {
                // 注意：本地開發時，請將 URL 改為 http://localhost:3000/ai_search
                const res = await fetch("https://usr-ai-search-demo.onrender.com/ai_search", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query: q })
                });

                const data = await res.json();
                if (data.error) {
                    document.getElementById("answer").innerText = "錯誤：" + data.error;
                } else {
                    document.getElementById("answer").innerText = data.answer + "\n\n來源說明：" + data.source;
                }
            } catch (e) {
                console.error(e);
                document.getElementById("answer").innerText = "呼叫 AI 失敗，請稍後再試。";
            }
        }

        // 回到 PlayReal：直接回到上一頁
        function goBack() {
            // 因為 PlayReal 的網址結構複雜，直接用 history.back() 回到上一頁最安全
            // 這會保留使用者的遊戲狀態
            window.history.back();
        }

        // 若你希望載入頁面就自動帶入 ?q= 參數，可在這裡呼叫：
        fillFromUrl();
    </script>

</body>

</html>