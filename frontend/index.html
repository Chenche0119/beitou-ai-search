<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <title>AI 搜尋練習</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            background-color: #f9f9f9;
            color: #333;
            font-size: 18px;
            /* 基礎字體加大 */
        }

        h2 {
            margin-bottom: 16px;
            color: #2c3e50;
            text-align: center;
            font-size: 28px;
            /* 標題加大 */
        }

        p {
            margin-bottom: 16px;
            color: #666;
            font-size: 18px;
            /* 說明文字加大 */
        }

        #query {
            width: 100%;
            padding: 16px;
            /* 增加內距 */
            font-size: 20px;
            /* 輸入框字體加大 */
            border: 2px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            margin-bottom: 16px;
            resize: none;
            /* 禁止手動調整大小 */
            overflow: hidden;
            /* 隱藏捲軸 */
            min-height: 60px;
            /* 設定最小高度 */
            font-family: inherit;
            /* 繼承字體設定 */
        }

        #query:focus {
            border-color: #4a90e2;
            outline: none;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            /* 手機版自動換行 */
            margin-bottom: 24px;
        }

        button {
            padding: 16px 24px;
            /* 按鈕變大 */
            font-size: 20px;
            /* 按鈕字體加大 */
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
            flex: 1;
            /* 按鈕平均分配寬度 */
            min-width: 140px;
            /* 防止按鈕太小 */
        }

        button.primary {
            background-color: #4a90e2;
            color: white;
        }

        button.primary:hover {
            background-color: #357abd;
        }

        button.secondary {
            background-color: #e0e0e0;
            color: #333;
        }

        button.secondary:hover {
            background-color: #d0d0d0;
        }

        #answer {
            white-space: pre-wrap;
            margin-top: 24px;
            background-color: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            line-height: 1.8;
            font-size: 20px;
            /* 回答內容字體加大 */
        }

        /* 手機版優化 */
        @media (max-width: 600px) {
            body {
                padding: 16px;
            }

            h2 {
                font-size: 26px;
            }

            button {
                width: 100%;
                /* 手機版按鈕滿版 */
                flex: none;
                padding: 16px;
                /* 手機版按鈕更好按 */
            }
        }
    </style>
</head>

<body>

    <h2>AI 搜尋練習</h2>

    <p>輸入你想查詢的內容與來源（直接點按「開始搜尋」即可）</p>

    <textarea id="query" placeholder="輸入搜尋句..." rows="1"></textarea>

    <div class="btn-group">
        <button class="primary" onclick="search()">開始搜尋</button>
        <!-- <button class="secondary" onclick="fillFromUrl()">帶入 PlayReal 搜尋句</button> -->
    </div>

    <div id="answer"></div>

    <div class="btn-group">
        <button class="secondary" onclick="goBack()">回到遊戲</button>
    </div>

    <script>
        // 自動調整高度的函式
        function autoResize() {
            const textarea = document.getElementById("query");
            textarea.style.height = 'auto'; // 先重置高度
            textarea.style.height = textarea.scrollHeight + 'px'; // 設定為內容高度
        }

        // 綁定輸入事件
        document.getElementById("query").addEventListener("input", autoResize);

        // 讀取 URL querystring 中的 ?q= 參數
        function getQueryParam(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name) || "";
        }

        // 從 URL 把 PlayReal 傳來的搜尋句塞進輸入框
        function fillFromUrl() {
            const q = getQueryParam("q");
            if (q) {
                // 使用 decodeURIComponent 確保中文能正確顯示
                const decodedQ = decodeURIComponent(q);
                const textarea = document.getElementById("query");
                textarea.value = decodedQ;
                // 填入內容後自動調整高度
                autoResize();
            }
        }

        async function search() {
            const q = document.getElementById("query").value.trim();
            if (!q) {
                alert("請先輸入搜尋句");
                return;
            }

            document.getElementById("answer").innerText = "搜尋中，請稍候……";

            try {
                // 注意：本地開發時，請將 URL 改為 http://localhost:3000/ai_search
                const res = await fetch("https://usr-ai-search-demo.onrender.com/ai_search", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query: q })
                });

                const data = await res.json();
                if (data.error) {
                    document.getElementById("answer").innerText = "錯誤：" + data.error;
                } else {
                    document.getElementById("answer").innerText = data.answer + "\n\n來源說明：" + data.source;
                }
            } catch (e) {
                console.error(e);
                document.getElementById("answer").innerText = "呼叫 AI 失敗，請稍後再試。";
            }
        }

        // 回到 PlayReal：直接回到上一頁
        function goBack() {
            // 因為 PlayReal 的網址結構複雜，直接用 history.back() 回到上一頁最安全
            // 這會保留使用者的遊戲狀態
            window.history.back();
        }

        // 若你希望載入頁面就自動帶入 ?q= 參數，可在這裡呼叫：
        fillFromUrl();
    </script>

</body>

</html>